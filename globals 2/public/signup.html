<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Globals - Signup</title>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js"></script>
  <script src="firebaseConfig.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">

  <div class="bg-white shadow-lg rounded-xl p-8 w-full max-w-md">
    
    <!-- Logo + Heading -->
    <img src="VERIFIED1.jpg" alt="Globals" class="mx-auto w-24 h-auto mb-4" />
    <h2 class="text-2xl font-bold text-center">Create account</h2>
    <p class="text-sm text-center text-gray-600 mb-6">Enter your details to create account.</p>
    
    <!-- Signup Form -->
    <form id="signupForm" class="space-y-4">
      <input id="fullName" type="text" placeholder="Full Name" required
        class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring focus:ring-blue-400">

      <input id="username" type="text" placeholder="Username" required
        class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring focus:ring-blue-400">

      <input id="phone" type="text" placeholder="Phone Number" required
        class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring focus:ring-blue-400">

      <input id="email" type="email" placeholder="Email (must be Gmail)" required
        class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring focus:ring-blue-400">

      <!-- Password -->
      <div class="relative">
        <input id="password" type="password" placeholder="Password" required
          class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring focus:ring-blue-400 pr-10">
        <button type="button" onclick="togglePasswordVisibility('password', this)" 
          class="absolute inset-y-0 right-0 px-3 flex items-center text-gray-500">üëÅ</button>
      </div>

      <!-- Confirm Password -->
      <div class="relative">
        <input id="confirmPassword" type="password" placeholder="Confirm Password" required
          class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring focus:ring-blue-400 pr-10">
        <button type="button" onclick="togglePasswordVisibility('confirmPassword', this)" 
          class="absolute inset-y-0 right-0 px-3 flex items-center text-gray-500">üëÅ</button>
      </div>

      <!-- How did you hear about us -->
      <select id="heardAbout" required
        class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring focus:ring-blue-400">
        <option value="">How did you hear about us?</option>
        <option value="instagram">Instagram</option>
        <option value="tiktok">TikTok</option>
        <option value="facebook">Facebook</option>
        <option value="whatsapp">WhatsApp</option>
        <option value="x">X</option>
        <option value="telegram">Telegram</option>
        <option value="friend">Friend</option>
        <option value="others">Others</option>
      </select>

      <!-- Optional Referrer -->
      <input id="referrer" type="text" placeholder="Referral Username (optional)"
        class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring focus:ring-blue-400">

      <button type="submit"
        class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 rounded-lg font-medium">Sign Up</button>

      <div id="message" class="text-center text-sm mt-2"></div>
    </form>
  </div>

  <script>
    const app = firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // Toggle password visibility
    function togglePasswordVisibility(id, btn) {
      const input = document.getElementById(id);
      if (input.type === "password") {
        input.type = "text";
        btn.textContent = "üôà";
      } else {
        input.type = "password";
        btn.textContent = "üëÅ";
      }
    }

    // Validation helpers
    function isValidNigerianPhone(phone) {
      const cleaned = phone.trim();
      return /^(0\d{10}|\+234\d{10})$/.test(cleaned);
    }
    function isGmailAddress(email) {
      if (!email) return false;
      const e = email.trim().toLowerCase();
      return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e) && e.endsWith('@gmail.com');
    }

    document.getElementById("signupForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const fullName = document.getElementById("fullName").value.trim();
      const username = document.getElementById("username").value.trim();
      const phone = document.getElementById("phone").value.trim();
      const email = document.getElementById("email").value.trim();
      const password = document.getElementById("password").value;
      const confirmPassword = document.getElementById("confirmPassword").value;
      const heardAbout = document.getElementById("heardAbout").value;
      const referrer = document.getElementById("referrer").value.trim();
      const messageDiv = document.getElementById("message");

      // Validations
      if (!isValidNigerianPhone(phone)) {
        messageDiv.textContent = "‚ùå Enter a valid Nigerian phone (11 digits or +234...)";
        messageDiv.className = "text-red-600 text-center";
        return;
      }
      if (!isGmailAddress(email)) {
        messageDiv.textContent = "‚ùå Please use a Gmail address (example@gmail.com)";
        messageDiv.className = "text-red-600 text-center";
        return;
      }
      if (password !== confirmPassword) {
        messageDiv.textContent = "‚ùå Passwords do not match.";
        messageDiv.className = "text-red-600 text-center";
        return;
      }
      if (!heardAbout) {
        messageDiv.textContent = "‚ùå Please tell us how you heard about us.";
        messageDiv.className = "text-red-600 text-center";
        return;
      }

      try {
        const userCredential = await auth.createUserWithEmailAndPassword(email, password);
        const userId = userCredential.user.uid;

        const userData = {
          fullName,
          username,
          phone,
          email,
          joinedAt: new Date(),
          balance: 0,
          referrer: referrer || null,
          heardAbout
        };

        await db.collection("users").doc(userId).set(userData);
        messageDiv.textContent = "‚úÖ Account created successfully!";
        messageDiv.className = "text-green-600 text-center";
      } catch (error) {
        messageDiv.textContent = "‚ùå " + error.message;
        messageDiv.className = "text-red-600 text-center";
      }
    });
  </script>

</body>
</html>
